#!/bin/bash

## Make sure PSPDEV is set
if [ -z "${PSPDEV}" ]; then
    export PSPDEV=/usr/local/pspdev
fi

## Use sudo if the current user doesn't own $PSPDEV
if ! touch "${PSPDEV}" >/dev/null 2>&1; then
    sudo "$0" "$@"
    exit $?
fi

## Run pacman
if which "pacman" >/dev/null 2>&1; then
    PACMAN_CONFIG="${PSPDEV}/share/pacman/etc/pacman.conf"
    pacman --config "${PACMAN_CONFIG}" "$@"
else
    export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:${PSPDEV}/share/pacman/lib/x86_64-linux-gnu
    "${PSPDEV}/share/pacman/bin/pacman" "$@"
fi